有一次面试被问到了sql优化相关内容，现记录于此。
由于笔者的工作场景对sql的优化使用不是很多且数据量较小，因此这块一直是一个盲区，借此对sql优化做一个梳理。
对于海量数据场景，sql的优化是非常重要的，优质sql和劣质sql在执行速度上可以达到上百倍。多数情况下，Oracle使用索引来快速遍历表，优化器主要根据定义的
索引来提高性能，如果sql语句中的where子句不合理，则可能导致sql放弃索引而进行全表扫描。
优化规则：
一、表连接
   1、表连接越多，性能越差；
   2、外链接效果差，因为必须对左右表进行表扫描，尽量使用inner join查询；
二、如果不可避免，可以考虑使用临时表或变量存放中间结果；
三、减少子查询；
四、视图嵌套不要超过2个为宜；
五、SQL的编写：
    1、NULL列使用索引没有意义，包含NULL值的列都不会被包含在索引中。因此，where语句中的is null 或 is not null的语句优化器是不允许使用索引的；
    2、concat 或 ||（mysql和oracle的字符串连接操作）：如果对列进行该函数操作，也会忽略使用索引；
    3、like,通配符出现在首位，无法使用索引；
    4、order by 表达式，不要使用非索引或嵌套表达式，这样可能会导致性能下降；
    5、Not运算（!=），也会导致无法使用索引；
    6、exists 替代 in，not in 最低效，会导致全表查询，可以考虑外链接或者not exists;
    7、索引，好处是实现折半查找，问题是需要额外的空间，而且每次insert update delete 都会对索引进行更新，增加IO；
    8、union 和 union all，union 有去重功效，增加计算时间，而union all 则不会；
    9、避免select *;
    10、避免在where 子句中对字段进行表达式操作，或是对字段进行函数操作，这样会导致全表扫描；
    11、
    
    --------------------------------------------20190228--------------------------------------------------
    MySQL的优化方案：
    一、基础知识
    1、MySQL的两种引擎：MyISAM和InnDB,其中MyISAM适合SELECT密集型的表，而InnDB适合INSERT和UPDATE密集型的表；
    InnoDB在MySQL5.5之后成为了默认引擎，其特点是支持行级锁、支持事物、支持外键等；
    MyISAM在MySQL5.5之前是默认引擎，其不支持事物、不支持外键、不支持行锁，读取时需对所有表加锁，写入时则对表加排他锁；
    二、分表-垂直拆分
    垂直分库，把数据库里表的相关性进行拆分，一个数据库里面既存在用户数据，又存在订单数据，那么垂直拆分可以把用户数据放到用户库、把订单数据放到订单库；
    垂直分表，对数据表进行拆分，多个字段的大表拆分成常用字段和非常用字段，每个表的字段不同，使用主键关联；
    优点：
    1、一个数据块（Block）能存放更多的数据，减少查询时的io次数；
    2、数据维护简单；
    缺点：
    1、主键出现冗余，需要管理冗余列；
    2、表间的JOIN会增加CPU开销；
    3、依然存在单表数据量过大的问题，需水平拆分；
    4、事物处理复杂；
    三、水平拆分
    1、水平拆分是通过某种策略将数据分片存储，可库内分表和分库两部分，每片数据会分散到不同的MySQL表或库，达到分布式的效果，能够支持非常大的数据量。
    优点：
    1、不存在单库大数据高并发的性能瓶颈（分布式？）
    2、应用读哪改造少；
    3、提供系统的稳定性和负债能力；
    缺点：
    1、分片事务一致性难以解决；
    2、跨节点的Join性能差，逻辑复杂；
    3、数据多次扩展南端极大；
    
    --------------------锁机制----------------------
    
    --------------------事务管理--------------------
    
    --------------------索引及其数据结构-------------
    
    
    
    
    
    
    
